var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,o=(e,o)=>{for(var l in o||(o={}))a.call(o,l)&&r(e,l,o[l]);if(t)for(var l of t(o))n.call(o,l)&&r(e,l,o[l]);return e};import{D as l,R as i,a as s}from"./vendor.61a01bb1.js";function c(e,t,a){const n=4*(t+e.width*a),r=e.data;return{r:r[n],g:r[n+1],b:r[n+2],a:r[n+3]}}function h(e,t,a,n,r,o,l=255){const i=4*(t+e.width*a),s=e.data;[s[i],s[i+1],s[i+2],s[i+3]]=[n,r,o,l]}class g{debouce(e,t){(null==this?void 0:this.timeout)&&clearTimeout(this.timeout),this.timeout=setTimeout(e,t)}}function d(e,t,a,n=0){const r=e.getContext("2d"),o=t.getContext("2d"),l=r.getImageData(0,0,e.width,e.height),i=r.getImageData(0,0,e.width,e.height),s=Math.floor(a[0].length/2);for(let g=0;g<l.width;g++)for(let e=0;e<l.height;e++){let[t,r,o,d]=[0,0,0,0];for(let n=g-s,i=0;n<=g+s;n++,i++)for(let h=e-s,g=0;h<=e+s;h++,g++){const e=a[g][i],s=c(l,n,h);t+=s.r*e,r+=s.g*e,o+=s.b*e,d+=s.a*e}n&&(t*=n,r*=n,o*=n,d=255),h(i,g,e,t,r,o,d+0*(255-d))}o.putImageData(i,0,0)}function m(){const{filters:e,updateFilters:t}=l.exports.useContext(u),a=new g;function n(n){a.debouce((()=>{t(o(o({},e),n))}),100)}return i.createElement("div",{className:"filter"},i.createElement("h2",null,"Filters"),i.createElement("div",{className:"filter__content"},i.createElement("div",{className:"filter__item"},"Grayscale",i.createElement("input",{type:"checkbox",defaultChecked:e.grayscale,onChange:e=>n({grayscale:e.target.checked})})),i.createElement("div",{className:"filter__item"},"Brighten (",e.brighten,")",i.createElement("input",{type:"range",min:"0",max:"255",value:e.brighten,onChange:e=>n({brighten:Number(e.target.value)})})),i.createElement("div",{className:"filter__item"},"Threshold (",e.threshold,")",i.createElement("input",{type:"range",min:"0",max:"255",value:e.threshold,onChange:e=>n({threshold:Number(e.target.value)})})),i.createElement("div",{className:"filter__item"},"Blur",i.createElement("input",{type:"checkbox",defaultChecked:e.blur,onChange:e=>n({blur:e.target.checked})})),i.createElement("div",{className:"filter__item"},"Sharpen",i.createElement("input",{type:"checkbox",defaultChecked:e.sharpen,onChange:e=>n({sharpen:e.target.checked})})),i.createElement("div",{className:"filter__item"},"Sobel",i.createElement("input",{type:"checkbox",defaultChecked:e.sobel,onChange:e=>n({sobel:e.target.checked})})),i.createElement("div",{className:"filter__item"},"Median",i.createElement("input",{type:"checkbox",defaultChecked:e.median,onChange:e=>n({median:e.target.checked})}))))}const u=l.exports.createContext({});function f(){const[e,t]=l.exports.useState({brighten:0,grayscale:!1,threshold:0,blur:!1,sharpen:!1}),a=l.exports.useRef(null),n=l.exports.useRef(null),r="eevee.jpg";function o(e,t){return new Promise((a=>{const n=new Image;n.src=new URL({"./assets/eevee.jpg":"/img-proc-playground/assets/eevee.f21209da.jpg","./assets/noise1.jpg":"/img-proc-playground/assets/noise1.5887b9fb.jpg","./assets/noise2.jpg":"/img-proc-playground/assets/noise2.8c04d2c0.jpg","./assets/rose.jpg":"/img-proc-playground/assets/rose.97abcad8.jpg"}[`./assets/${t}`],window.location).href,n.crossOrigin="Anonymous",n.addEventListener("load",(()=>{!function(e,t){const a=e.getContext("2d");e.width=t.width,e.height=t.height,a.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height)}(e,n),a(null)}))}))}function s(e,t,a){const n=e=>e?t:a;let r=!0;e.brighten&&(!function(e,t,a){const n=e.getContext("2d"),r=t.getContext("2d"),o=n.getImageData(0,0,e.width,e.height),l=n.getImageData(0,0,e.width,e.height);for(let i=0;i<o.width;i++)for(let e=0;e<o.height;e++){const t=c(o,i,e),[n,r,s]=[t.r+a,t.g+a,t.b+a];h(l,i,e,n,r,s)}r.putImageData(l,0,0)}(n(r),a,e.brighten),r=!1),e.grayscale&&(!function(e,t){const a=e.getContext("2d"),n=t.getContext("2d"),r=a.getImageData(0,0,e.width,e.height),o=a.getImageData(0,0,e.width,e.height);for(let l=0;l<r.width;l++)for(let e=0;e<r.height;e++){const t=c(r,l,e),a=.2126*t.r+.7152*t.g+.0722*t.b;h(o,l,e,a,a,a)}n.putImageData(o,0,0)}(n(r),a),r=!1),e.threshold&&(!function(e,t,a){const n=e.getContext("2d"),r=t.getContext("2d"),o=n.getImageData(0,0,e.width,e.height),l=n.getImageData(0,0,e.width,e.height);for(let i=0;i<o.width;i++)for(let e=0;e<o.height;e++){const t=c(o,i,e),n=.2126*t.r+.7152*t.g+.0722*t.b>a?0:255;h(l,i,e,n,n,n)}r.putImageData(l,0,0)}(n(r),a,e.threshold),r=!1),e.blur&&(d(n(r),a,[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]]),r=!1),e.sharpen&&(!function(e,t){d(e,t,[[0,-1,0],[-1,5,-1],[0,-1,0]])}(n(r),a),r=!1),e.sobel&&(!function(e,t){d(e,t,[[-1,0,1],[-2,0,2],[-1,0,1]],.5),d(e,t,[[-1,-2,-1],[0,0,0],[1,2,1]],.5)}(n(r),a),r=!1),e.median&&(!function(e,t,a){const n=e.getContext("2d"),r=t.getContext("2d"),o=n.getImageData(0,0,e.width,e.height),l=n.getImageData(0,0,e.width,e.height),i=Math.floor(a/2);for(let s=0;s<o.width;s++)for(let e=0;e<o.height;e++){const t=[],a=[],n=[];for(let r=s-i;r<=s+i;r++)for(let l=e-i;l<=e+i;l++){const e=c(o,r,l);t.push(e.r),a.push(e.g),n.push(e.b)}h(l,s,e,t.sort(((e,t)=>e-t))[Math.floor(t.length/2)],a.sort(((e,t)=>e-t))[Math.floor(a.length/2)],n.sort(((e,t)=>e-t))[Math.floor(n.length/2)],255)}r.putImageData(l,0,0)}(n(r),a,5),r=!1)}return l.exports.useEffect((()=>{const t=a.current,l=n.current;Promise.all([o(t,r),o(l,r)]).then((()=>{s(e,t,l)}))}),[e]),i.createElement(u.Provider,{value:{filters:e,updateFilters:t}},i.createElement("div",{className:"content"},i.createElement(m,null),i.createElement("canvas",{ref:a}),i.createElement("canvas",{ref:n})))}s.render(i.createElement(i.StrictMode,null,i.createElement(f,null)),document.getElementById("root"));
